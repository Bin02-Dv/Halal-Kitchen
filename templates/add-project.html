{% extends "base.html" %}

{% load static %}

{% block title %}Add Product - Halal Kitchen Utensils Hub{% endblock %}

{% block content %}
<!-- Add Product Section -->
<section class="py-12 sm:py-16">
    <div class="container mx-auto px-4">
        <div id="auth-check" class="max-w-md mx-auto bg-white rounded-lg shadow-md p-6 sm:p-8">
            {% if current_user.email %}
            <h2 class="text-2xl sm:text-3xl font-bold text-center text-gray-800 mb-6 sm:mb-8">Add New Product</h2>
            <div class="space-y-6">
                <form id="add_product" method="POST">
                    {% csrf_token %}
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" for="product-name">Product Name</label>
                        <input type="text" name="product_name" id="product-name" class="w-full border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-halal-green" placeholder="Enter product name" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" for="product-price">Category</label>
                        <select name="category" id="category" class="w-full border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-halal-green" required>
                            <option value="">Select Category</option>
                            <option value="cookware">Cookware</option>
                            <option value="utensils">Utensils</option>
                            <option value="cutlery">Cutlery</option>
                            <option value="serveware">Serveware</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" for="product-price">Price (â‚¦)</label>
                        <input type="number" name="product_price" id="product-price" min="0" step="0.01" class="w-full border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-halal-green" placeholder="Enter price" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" for="product-description">Description</label>
                        <textarea id="product-description" name="product_description" class="w-full border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-halal-green" placeholder="Enter product description" rows="4" required></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" for="product-image">Product Image</label>
                        <input type="file" name="product_image" id="product-image" class="w-full border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-halal-green" placeholder="Enter image URL" required>
                    </div>
                    <button class="bg-halal-green text-white px-6 py-3 rounded-full font-semibold hover:bg-green-700 transition w-full text-center">
                        Add Product
                    </button>
                </form>
            </div>
            {% else %}
            <p class="text-center text-gray-600">You must be logged in to add products. <a href="/login/" class="text-halal-green hover:underline">Login</a></p>
            {% endif %}
        </div>
    </div>
</section>

<script src="{% static 'js/jquery-3.5.1.js' %}"></script>
<script>
    // ajax
$(document).on('submit', '#add_product', function (e){
    e.preventDefault();
    var m_success = $(".success");
    var m_error = $(".error");
    var m_info = $(".info");
    var m_text = $(".message");

    var formData = new FormData(this);

    $.ajax({
        type: 'POST',
        url: "/add-product/",
        data: formData,
        processData: false,
        contentType: false,
        success: function (response){
            var success = response['success'];
            if(success){
                m_success.show();
                m_error.hide();
                m_info.hide();

                m_text.html('');
                m_text.append(response['message']);

                setTimeout(() => {
                    $(".toast").fadeOut();
                }, 5000);

            }else{
                m_error.show();
                m_success.hide();
                m_info.hide();

                m_text.html('');
                m_text.append(response['message']);

                setTimeout(() => {
                    $(".toast").fadeOut();
                }, 5000);
            }

        }
    });
});
</script>
{% endblock %}